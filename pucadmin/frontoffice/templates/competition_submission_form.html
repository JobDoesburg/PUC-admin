{% load i18n %}
<form method="post" id="form-container" enctype="multipart/form-data">{% csrf_token %}
    {{ form.as_p }}
    <h2>{% trans "Students" %}:</h2>
    {{ students.management_form }}
    {% for form in students %}
        <div class="student-form">
            {{form.as_p}}
        </div>
    {% endfor %}
    <button id="add-student-form" type="button">{% trans "Add student" %}</button>
    <button id="delete-student-form" type="button">{% trans "Delete student" %}</button>
    <h2>{% trans "Supervisors" %}:</h2>
    {{ supervisors.management_form }}
    {% for form in supervisors %}
        <div class="supervisor-form">
            {{form.as_p}}
        </div>
    {% endfor %}
    <button id="add-supervisor-form" type="button">{% trans "Add supervisor" %}</button>
    <button id="delete-supervisor-form" type="button">{% trans "Delete supervisor" %}</button>
    <input type="submit" value="{% trans "submit" %}">
</form>
<script>
    let container = document.querySelector("#form-container")

    let studentForm = document.querySelectorAll(".student-form")
    let addStudentButton = document.querySelector("#add-student-form")
    let deleteStudentButton = document.querySelector("#delete-student-form")
    let totalStudentsForms = document.querySelector("#id_authors-TOTAL_FORMS")
    let studentFormNum = totalStudentsForms.getAttribute("value")
    let maxStudentsForms = document.querySelector("#id_authors-MAX_NUM_FORMS").getAttribute("value")
    let minStudentsForms = document.querySelector("#id_authors-MIN_NUM_FORMS").getAttribute("value")
    addStudentButton.addEventListener('click', addStudentForm)
    deleteStudentButton.addEventListener('click', deleteStudentForm)
    function addStudentForm(e){
        e.preventDefault()

        if (studentFormNum < maxStudentsForms){
            let newForm = studentForm[0].cloneNode(true)
            let formRegex = RegExp(`authors-(\\d){1}-`,'g')

            studentFormNum++
            newForm.innerHTML = newForm.innerHTML.replace(formRegex, `authors-${studentFormNum-1}-`)
            container.insertBefore(newForm, addStudentButton)

            totalStudentsForms.setAttribute('value', `${studentFormNum}`)
        }
    }
    function deleteStudentForm(e){
        e.preventDefault()

        if (studentFormNum > minStudentsForms) {
            studentForm = document.querySelectorAll(".student-form")
            studentForm[studentForm.length-1].remove()
            studentFormNum--
            totalStudentsForms.setAttribute('value', `${studentFormNum}`)

        }
    }


    let supervisorForm = document.querySelectorAll(".supervisor-form")
    let addSupervisorButton = document.querySelector("#add-supervisor-form")
    let deleteSupervisorButton = document.querySelector("#delete-supervisor-form")
    let totalSupervisorsForms = document.querySelector("#id_supervisors-TOTAL_FORMS")
    let supervisorFormNum = totalSupervisorsForms.getAttribute("value")
    let maxSupervisorForms = document.querySelector("#id_supervisors-MAX_NUM_FORMS").getAttribute("value")
    let minSupervisorForms = document.querySelector("#id_supervisors-MIN_NUM_FORMS").getAttribute("value")
    addSupervisorButton.addEventListener('click', addSupervisorForm)
    deleteSupervisorButton.addEventListener('click', deleteSupervisorForm)
    function addSupervisorForm(e) {
        e.preventDefault()

        if (supervisorFormNum < maxSupervisorForms) {
            let newForm = supervisorForm[0].cloneNode(true)
            let formRegex = RegExp(`supervisors-(\\d){1}-`, 'g')

            supervisorFormNum++
            newForm.innerHTML = newForm.innerHTML.replace(formRegex, `supervisors-${supervisorFormNum-1}-`)
            container.insertBefore(newForm, addSupervisorButton)

            totalSupervisorsForms.setAttribute('value', `${supervisorFormNum }`)
        }
    }
    function deleteSupervisorForm(e){
        e.preventDefault()

        if (supervisorFormNum > minSupervisorForms) {
            supervisorForm = document.querySelectorAll(".supervisor-form")
            supervisorForm[supervisorForm.length-1].remove()
            supervisorFormNum--
            totalSupervisorsForms.setAttribute('value', `${supervisorFormNum}`)
        }
    }
</script>
